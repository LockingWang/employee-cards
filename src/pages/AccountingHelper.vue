<template>
  <div class="min-h-screen bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50">
    <!-- è¿”å›æŒ‰éˆ• -->
    <div class="container mx-auto px-4 pt-6">
      <button 
        @click="goBack"
        class="back-button group"
      >
        <ArrowLeft class="w-5 h-5 mr-2" />
        è¿”å›é¦–é 
      </button>
    </div>

    <!-- ç¶²ç«™æ¨™é¡Œ -->
    <header class="text-center py-8 px-4">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4 font-nunito">
        è¨˜å¸³å°å¹«æ‰‹
        <span class="text-5xl">ğŸ’°</span>
      </h1>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        è¼•é¬†ç®¡ç†æ‚¨çš„è²¡å‹™ï¼Œè¨˜éŒ„æ”¶æ”¯ï¼Œåˆ†ææ¶ˆè²»ç¿’æ…£ï¼Œè®“ç†è²¡è®Šå¾—ç°¡å–®ï¼
      </p>
    </header>

    <!-- ä¸»è¦åŠŸèƒ½å€åŸŸ -->
    <main class="container mx-auto px-4 pb-12">
      <!-- å¿«é€Ÿè¨˜å¸³ -->
      <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
          <PlusCircle class="w-8 h-8 mr-3 text-green-500" />
          å¿«é€Ÿè¨˜å¸³
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- æ”¶å…¥ -->
          <div class="space-y-4">
            <h3 class="text-lg font-semibold text-green-600">æ”¶å…¥</h3>
            <div class="space-y-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">é‡‘é¡</label>
                <input 
                  v-model="incomeAmount"
                  type="number"
                  placeholder="è¼¸å…¥é‡‘é¡"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">é¡åˆ¥</label>
                <select 
                  v-model="incomeCategory"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                >
                  <option value="">é¸æ“‡é¡åˆ¥</option>
                  <option value="è–ªè³‡">è–ªè³‡</option>
                  <option value="çé‡‘">çé‡‘</option>
                  <option value="æŠ•è³‡">æŠ•è³‡</option>
                  <option value="å…¶ä»–">å…¶ä»–</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">å‚™è¨»</label>
                <input 
                  v-model="incomeNote"
                  type="text"
                  placeholder="å‚™è¨»èªªæ˜"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                />
              </div>
              <button 
                @click="addIncome"
                class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-4 rounded-lg transition-colors"
              >
                è¨˜éŒ„æ”¶å…¥
              </button>
            </div>
          </div>

          <!-- æ”¯å‡º -->
          <div class="space-y-4">
            <h3 class="text-lg font-semibold text-red-600">æ”¯å‡º</h3>
            <div class="space-y-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">é‡‘é¡</label>
                <input 
                  v-model="expenseAmount"
                  type="number"
                  placeholder="è¼¸å…¥é‡‘é¡"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">é¡åˆ¥</label>
                <select 
                  v-model="expenseCategory"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                >
                  <option value="">é¸æ“‡é¡åˆ¥</option>
                  <option value="é¤é£²">é¤é£²</option>
                  <option value="äº¤é€š">äº¤é€š</option>
                  <option value="è³¼ç‰©">è³¼ç‰©</option>
                  <option value="å¨›æ¨‚">å¨›æ¨‚</option>
                  <option value="é†«ç™‚">é†«ç™‚</option>
                  <option value="å…¶ä»–">å…¶ä»–</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">å‚™è¨»</label>
                <input 
                  v-model="expenseNote"
                  type="text"
                  placeholder="å‚™è¨»èªªæ˜"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                />
              </div>
              <button 
                @click="addExpense"
                class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-4 rounded-lg transition-colors"
              >
                è¨˜éŒ„æ”¯å‡º
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- çµ±è¨ˆæ¦‚è¦½ -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white rounded-xl shadow-lg p-6 text-center">
          <div class="text-3xl font-bold text-green-600 mb-2">${{ totalIncome.toLocaleString() }}</div>
          <div class="text-gray-600">æœ¬æœˆæ”¶å…¥</div>
        </div>
        <div class="bg-white rounded-xl shadow-lg p-6 text-center">
          <div class="text-3xl font-bold text-red-600 mb-2">${{ totalExpense.toLocaleString() }}</div>
          <div class="text-gray-600">æœ¬æœˆæ”¯å‡º</div>
        </div>
        <div class="bg-white rounded-xl shadow-lg p-6 text-center">
          <div class="text-3xl font-bold" :class="balance >= 0 ? 'text-green-600' : 'text-red-600'">
            ${{ balance.toLocaleString() }}
          </div>
          <div class="text-gray-600">æœ¬æœˆçµé¤˜</div>
        </div>
      </div>

      <!-- æœ€è¿‘è¨˜éŒ„ -->
      <div class="bg-white rounded-2xl shadow-lg p-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
          <History class="w-8 h-8 mr-3 text-blue-500" />
          æœ€è¿‘è¨˜éŒ„
        </h2>
        
        <div v-if="records.length === 0" class="text-center py-8 text-gray-500">
          é‚„æ²’æœ‰ä»»ä½•è¨˜éŒ„ï¼Œé–‹å§‹è¨˜å¸³å§ï¼
        </div>
        
        <div v-else class="space-y-3">
          <div 
            v-for="record in records.slice(0, 10)" 
            :key="record.id"
            class="flex items-center justify-between p-4 bg-gray-50 rounded-lg"
          >
            <div class="flex items-center">
              <div 
                class="w-3 h-3 rounded-full mr-3"
                :class="record.type === 'income' ? 'bg-green-500' : 'bg-red-500'"
              ></div>
              <div>
                <div class="font-semibold">{{ record.category }}</div>
                <div class="text-sm text-gray-600">{{ record.note }}</div>
              </div>
            </div>
            <div class="text-right">
              <div 
                class="font-bold"
                :class="record.type === 'income' ? 'text-green-600' : 'text-red-600'"
              >
                {{ record.type === 'income' ? '+' : '-' }}${{ record.amount.toLocaleString() }}
              </div>
              <div class="text-sm text-gray-500">{{ formatDate(record.date) }}</div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- å¯æ„›è£é£¾ -->
    <div class="fixed top-10 left-10 text-2xl animate-pulse">ğŸ’°</div>
    <div class="fixed top-20 right-20 text-xl animate-bounce">ğŸ“Š</div>
    <div class="fixed bottom-20 left-20 text-2xl animate-pulse">ğŸ’³</div>
    <div class="fixed bottom-10 right-10 text-xl animate-bounce">ğŸ“ˆ</div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { ArrowLeft, PlusCircle, History } from 'lucide-vue-next'

const router = useRouter()

// è¡¨å–®è³‡æ–™
const incomeAmount = ref('')
const incomeCategory = ref('')
const incomeNote = ref('')
const expenseAmount = ref('')
const expenseCategory = ref('')
const expenseNote = ref('')

// è¨˜éŒ„è³‡æ–™
const records = ref<Array<{
  id: string
  type: 'income' | 'expense'
  amount: number
  category: string
  note: string
  date: Date
}>>([])

// è¨ˆç®—å±¬æ€§
const totalIncome = computed(() => {
  return records.value
    .filter(r => r.type === 'income')
    .reduce((sum, r) => sum + r.amount, 0)
})

const totalExpense = computed(() => {
  return records.value
    .filter(r => r.type === 'expense')
    .reduce((sum, r) => sum + r.amount, 0)
})

const balance = computed(() => {
  return totalIncome.value - totalExpense.value
})

// æ–¹æ³•
const goBack = () => {
  router.push('/')
}

const addIncome = () => {
  if (!incomeAmount.value || !incomeCategory.value) return
  
  records.value.unshift({
    id: Date.now().toString(),
    type: 'income',
    amount: Number(incomeAmount.value),
    category: incomeCategory.value,
    note: incomeNote.value,
    date: new Date()
  })
  
  // æ¸…ç©ºè¡¨å–®
  incomeAmount.value = ''
  incomeCategory.value = ''
  incomeNote.value = ''
}

const addExpense = () => {
  if (!expenseAmount.value || !expenseCategory.value) return
  
  records.value.unshift({
    id: Date.now().toString(),
    type: 'expense',
    amount: Number(expenseAmount.value),
    category: expenseCategory.value,
    note: expenseNote.value,
    date: new Date()
  })
  
  // æ¸…ç©ºè¡¨å–®
  expenseAmount.value = ''
  expenseCategory.value = ''
  expenseNote.value = ''
}

const formatDate = (date: Date) => {
  return date.toLocaleDateString('zh-TW', {
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  })
}

onMounted(() => {
  // è¼‰å…¥ç¯„ä¾‹è³‡æ–™
  records.value = [
    {
      id: '1',
      type: 'income',
      amount: 50000,
      category: 'è–ªè³‡',
      note: 'æœˆè–ª',
      date: new Date()
    },
    {
      id: '2',
      type: 'expense',
      amount: 1200,
      category: 'é¤é£²',
      note: 'åˆé¤',
      date: new Date(Date.now() - 86400000)
    },
    {
      id: '3',
      type: 'expense',
      amount: 300,
      category: 'äº¤é€š',
      note: 'æ·é‹',
      date: new Date(Date.now() - 172800000)
    }
  ]
})
</script>

<style scoped>
/* è¿”å›æŒ‰éˆ•æ¨£å¼ */
.back-button {
  display: inline-flex;
  align-items: center;
  background: linear-gradient(135deg, #fef3c7, #fde68a);
  color: #92400e;
  padding: 12px 20px;
  border-radius: 12px;
  font-weight: 600;
  font-size: 0.95rem;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.back-button:hover {
  background: linear-gradient(135deg, #fde68a, #fcd34d);
  transform: translateY(-2px);
  box-shadow: 0 8px 12px -2px rgba(0, 0, 0, 0.15);
}

.back-button:hover svg {
  transform: translateX(-4px);
}

.back-button svg {
  transition: transform 0.3s ease;
}

/* ç¢ºä¿å…§å®¹åœ¨è£é£¾ä¹‹ä¸Š */
main {
  position: relative;
  z-index: 10;
}

header {
  position: relative;
  z-index: 10;
}
</style>
